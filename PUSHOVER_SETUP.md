# Настройка Pushover для уведомлений на часы

## Обзор

Интеграция с Pushover позволяет отправлять уведомления прямо на носимые устройства (Garmin, Apple Watch, Wear OS), обеспечивая более эффективное взаимодействие с пользователями.

## Преимущества Pushover

- **Высокий приоритет**: Уведомления пробиваются через режим "Не беспокоить"
- **Мгновенная доставка**: Уведомления приходят на все устройства пользователя
- **Настраиваемые звуки**: 22 различных звука уведомлений
- **Повторные напоминания**: Автоматические повторы для важных уведомлений
- **Поддержка носимых устройств**: Garmin, Apple Watch, Wear OS, Pebble

## Настройка для разработчика

### 1. Создание приложения Pushover

1. Зайдите на https://pushover.net/apps/build
2. Создайте новое приложение:
   - **Name**: MSE Telegram Bot
   - **Type**: Application
   - **Description**: Telegram bot for mindfulness surveys
   - **URL**: (необязательно)
   - **Icon**: Загрузите логотип приложения

3. Получите **Application API Token**

### 2. Настройка переменных окружения

Добавьте в `.env` файл:

```env
# Pushover Configuration
PUSHOVER_APP_TOKEN=your_app_token_here
BOT_USERNAME=your_bot_username
```

### 3. Проверка интеграции

Запустите бота и используйте команду `/pushover` для тестирования.

## Настройка для пользователей

### 1. Установка Pushover

Пользователям нужно:
1. Установить приложение Pushover на телефон ($5 единоразово)
2. Зарегистрироваться и получить User Key
3. Настроить пересылку на носимые устройства

### 2. Подключение к боту

1. Используйте команду `/pushover` в боте
2. Следуйте инструкциям по настройке
3. Введите свой User Key
4. Протестируйте соединение

### 3. Настройка часов

#### Для Garmin:
1. Откройте приложение Garmin Connect
2. Перейдите в Settings → Smart Notifications
3. Включите уведомления от Pushover

#### Для Apple Watch:
1. Откройте Watch app на iPhone
2. Notifications → Pushover → Allow Notifications
3. Настройте звуки и haptic feedback

#### Для Wear OS:
1. Откройте приложение Pushover
2. Включите синхронизацию с часами
3. Настройте приоритеты уведомлений

## Использование в боте

### Основные команды

- `/pushover` - Основное меню настройки
- `/pushover [user_key]` - Быстрая настройка с ключом

### Доступные настройки

- **Приоритет уведомлений**: От тихих до экстренных
- **Звуки**: 22 различных варианта
- **Повторы**: Настройка повторных напоминаний

### Автоматическая отправка

Pushover уведомления автоматически отправляются:
- При обычных напоминаниях об опросах
- При эскалации (повышенный приоритет)
- Параллельно с Telegram уведомлениями

## Технические детали

### Структура данных пользователя

```javascript
settings: {
  pushover: {
    enabled: Boolean,
    userKey: String,
    priority: Number (-2 to 2),
    sound: String
  }
}
```

### API методы

- `sendSurveyNotification()` - Обычные опросы
- `sendEscalationNotification()` - Эскалация
- `testConnection()` - Проверка подключения

### Уровни приоритета

- `-2`: Тихие (без звука)
- `-1`: Обычные (без звука если телефон в беззвучном режиме)
- `0`: Обычные (со звуком)
- `1`: Высокий приоритет (пробивается через DND)
- `2`: Экстренные (требуют подтверждения)

## Мониторинг и аналитика

### Логирование

Все Pushover уведомления логируются с результатом доставки:

```
Pushover notification sent to [User]: success
Pushover notification failed for [User]: reason
```

### Метрики

Отслеживаются:
- Успешность доставки
- Время отклика пользователей
- Эффективность по сравнению с Telegram

## Стоимость

- **Для разработчика**: Бесплатно (до 7,500 уведомлений в месяц)
- **Для пользователей**: $5 единоразово за iOS/Android
- **Дополнительные устройства**: Бесплатно после покупки основного приложения

## Поддержка

При проблемах с настройкой:
1. Проверьте правильность User Key (30 символов)
2. Убедитесь, что PUSHOVER_APP_TOKEN настроен
3. Протестируйте соединение через `/pushover` → "Тест уведомления"
4. Проверьте настройки уведомлений на устройстве

## Альтернативы

Если Pushover недоступен:
- Стандартные Telegram уведомления остаются активными
- Можно настроить более агрессивную эскалацию в Telegram
- Рассмотреть интеграцию с другими push-сервисами